<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="carbcontpred">
<title>carbcontpred-vignette • carbcontpred</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="carbcontpred-vignette">
<meta property="og:description" content="carbcontpred">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-dark navbar-expand-lg bg-primary"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">carbcontpred</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.0.0.9000</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/carbcontpred-vignette.html">carbcontpred-vignette</a>
    <a class="dropdown-item" href="../articles/web_only/Background_Information.html">Background Information</a>
  </div>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/KangyuSo/carbcontpred/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>carbcontpred-vignette</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/KangyuSo/carbcontpred/blob/HEAD/vignettes/carbcontpred-vignette.Rmd" class="external-link"><code>vignettes/carbcontpred-vignette.Rmd</code></a></small>
      <div class="d-none name"><code>carbcontpred-vignette.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="carbcontpred-predicting-and-mapping-soil-organic-carbon-content-based-on-the-spectral-reflectance-of-soil-samples-in-hudson-bay-lowlands-ontario-canada">carbcontpred: Predicting and Mapping Soil Organic Carbon Content
Based on The Spectral Reflectance of Soil Samples in Hudson Bay
Lowlands, Ontario, Canada<a class="anchor" aria-label="anchor" href="#carbcontpred-predicting-and-mapping-soil-organic-carbon-content-based-on-the-spectral-reflectance-of-soil-samples-in-hudson-bay-lowlands-ontario-canada"></a>
</h2>
<p>This package contains objects that are sourced from a 2022 McMaster
Remote Sensing Laboratory research project and objects created to
facilitate the use and analysis of the fieldwork data. The project
recorded a wide range of biochemical, biophysical, and spectral metrics
of 432 soil samples that were collected from the Hudson Bay Lowlands (N
51.220318, W 80.556189) and measured and analyzed at McMaster University
and the University of Guelph. A portion of the project’s data has been
cleaned and packaged for easy use in an <code>R</code> environment.</p>
<p>The soil samples were collected from near the Kashechewan (N
52.253621, W 81.776621), Moose Factory (N 51.220318, W 80.556189), and
Attawapiskat (N 52.934019, W 82.377133) First Nation communities in
northern Ontario, Canada. The image below shows the 3 locations where
the soil samples were collected from:</p>
<p><img src="SoilSampleSites.png" style="width:90.0%"></p>
<p><strong>Figure 1.</strong> <em>A satellite image map of the portion
of the Hudson Bay Lowlands where the soil samples were collected from.
The legend displays the locations of the soil sample sites.</em></p>
<p>The project was funded by the Natural Sciences and Engineering
Research Council of Canada (NSERC) through the Discovery Grants program
(RGPIN-2020-05,708). The corresponding author is Kangyu So<a class="footnote-ref" tabindex="0" data-bs-toggle="popover" data-bs-content='&lt;p&gt;McMaster University, &lt;a href="mailto:sok11@mcmaster.ca" class="email"&gt;sok11@mcmaster.ca&lt;/a&gt;&lt;/p&gt;'><sup>1</sup></a>. The full list of
authors can be found here<a class="footnote-ref" tabindex="0" data-bs-toggle="popover" data-bs-content='&lt;p&gt;Authors: Kangyu So (McMaster University, &lt;a href="mailto:sok11@mcmaster.ca" class="email"&gt;sok11@mcmaster.ca&lt;/a&gt;),
Cheryl A. Rogers (McMaster University, &lt;a href="mailto:rogerc11@mcmaster.ca" class="email"&gt;rogerc11@mcmaster.ca&lt;/a&gt;), Alemu Gonsamo (McMaster
University, &lt;a href="mailto:gonsamoa@mcmaster.ca" class="email"&gt;gonsamoa@mcmaster.ca&lt;/a&gt;), Yiyao Li (McMaster University,
&lt;a href="mailto:liy571@mcmaster.ca" class="email"&gt;liy571@mcmaster.ca&lt;/a&gt;), James Snider (World Wildlife Fund
Canada, &lt;a href="mailto:jsnider@wwfcanada.org" class="email"&gt;jsnider@wwfcanada.org&lt;/a&gt;), Clare Wark (World Wildlife
Fund Canada, &lt;a href="mailto:cwark@wwfcanada.org" class="email"&gt;cwark@wwfcanada.org&lt;/a&gt;)&lt;/p&gt;'><sup>2</sup></a>.</p>
</div>
<div class="section level2">
<h2 id="what-is-this-package">What Is This Package?<a class="anchor" aria-label="anchor" href="#what-is-this-package"></a>
</h2>
<p>The package <code>carbcontpred</code> contains objects that are
sourced from a 2022 McMaster Remote Sensing Laboratory research project
and objects created to facilitate the use and analysis of the fieldwork
data. This package includes data on the spectral reflectance and organic
carbon content of soil samples after they have been dried in an oven for
48 hours. The package also includes the function <code>cpred</code> for
building a linear regression model to make organic carbon content
predictions, and an <code>R</code> Markdown file on pre-processing the
data for <code>cpred</code>. The package also includes the function
<code>mappred</code> for using the predictions from the linear
regression model to predict the organic carbon content of an Region of
Interest (ROI) spectral reflectance data table, and an <code>R</code>
Markdown file on pre-processing the data for <code>mappred</code>.</p>
<p>The raw data from the research project will eventually be freely
available to the public through a repository on GitHub, but it is bulky
and organized in a complicated manner. <code>carbcontpred</code>
pre-processes the data in <code>R</code>, extracting the portion of the
data that is useful for developing predictive models for carbon stock in
soil samples. The package also includes functions that can be used to
build predictive models or be tuned in the future by the authors or an
open-source community.</p>
</div>
<div class="section level2">
<h2 id="set-up">Set-Up<a class="anchor" aria-label="anchor" href="#set-up"></a>
</h2>
<div class="section level3">
<h3 id="installation">Installation<a class="anchor" aria-label="anchor" href="#installation"></a>
</h3>
<p>This is how you install the package if you have not done so yet:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html" class="external-link">install.packages</a></span><span class="op">(</span><span class="st">"remotes"</span>, repos <span class="op">=</span> <span class="st">"http://cran.us.r-project.org"</span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://remotes.r-lib.org" class="external-link">remotes</a></span><span class="op">)</span></span>
<span></span>
<span><span class="fu">remotes</span><span class="fu">::</span><span class="fu">install_github</span><span class="op">(</span><span class="st">"KangyuSo/carbcontpred"</span>, </span>
<span>                         build_vignettes <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<p>Begin by loading the package:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/KangyuSo/carbcontpred" class="external-link">carbcontpred</a></span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="pre-processing-data-for-cpred">Pre-Processing Data for cpred<a class="anchor" aria-label="anchor" href="#pre-processing-data-for-cpred"></a>
</h3>
<p>The 2022 McMaster Remote Sensing Laboratory research project
collected soil samples from the Hudson Bay Lowlands region in northern
Ontario, Canada (N 51.220318, W 80.556189). Included within are two csv
files containing data for the soil samples. The first csv file contains
data on the spectral reflectance of post-dried soil samples between the
wavelengths 350 nm and 2500 nm in increments of 1 nm.</p>
<p>The reflectance spectra are not normalized, so continuum removal must
be applied. Which is done using the following chunk:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ref_dry</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/apply.html" class="external-link">apply</a></span><span class="op">(</span><span class="va">data_ref</span><span class="op">[</span>,<span class="op">-</span><span class="fl">1</span><span class="op">]</span>, MARGIN<span class="op">=</span><span class="fl">2</span>, FUN <span class="op">=</span><span class="va">continuumRemoval</span>, wav <span class="op">=</span> <span class="va">data_ref</span><span class="op">$</span><span class="va">Wavelength</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">ref_dry</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span>Wavelength <span class="op">=</span> <span class="va">data_ref</span><span class="op">$</span><span class="va">Wavelength</span>, <span class="va">ref_dry</span><span class="op">)</span></span></code></pre></div>
<p>The table is still arranged so that its definitions are composed of
the wavelength and the ID of all of the soil samples, totaling 433
definitions. This is too many data definitions right now and we are only
interested in the average reflectance of a given wavelength range.</p>
<p>We will first calculate the average using the following chunk:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">start_row</span> <span class="op">&lt;-</span> <span class="fl">350</span></span>
<span><span class="va">end_row</span> <span class="op">&lt;-</span> <span class="fl">2500</span></span>
<span><span class="va">ref_dry</span> <span class="op">&lt;-</span> <span class="va">ref_dry</span><span class="op">[</span><span class="va">start_row</span><span class="op">:</span><span class="va">end_row</span>, <span class="fl">2</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">ncol</a></span><span class="op">(</span><span class="va">ref_dry</span><span class="op">)</span><span class="op">]</span></span>
<span><span class="va">avg_values</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/colSums.html" class="external-link">colMeans</a></span><span class="op">(</span><span class="va">ref_dry</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<p>Next, we will create a new dataset that records the sample ID and
average reflectance in a more acceptable format:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ref_dry_avg</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span>
<span>  <span class="st">"Sample_ID"</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">ref_dry</span><span class="op">)</span>,</span>
<span>  <span class="st">"Reflectance"</span> <span class="op">=</span> <span class="va">avg_values</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>Now, we have a dataset with our sample ID and average reflectance,
the latter of which will be the independent variable for the linear
regression model. We need to add our dependent variable to this dataset,
which would be the organic carbon content. This data is stored in
<code>SoilMetrics_v01.csv</code> in the
<code>\data-raw folder</code>.</p>
<p>We will merge the organic carbon content data from this dataset to
the dataset containing the sample ID and average reflectance using the
following chunk:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ref_dry_avg</span> <span class="op">&lt;-</span> <span class="va">ref_dry_avg</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">left_join</span><span class="op">(</span><span class="va">data_met</span> <span class="op">%&gt;%</span> <span class="fu">select</span><span class="op">(</span><span class="va">Sample_ID</span>, <span class="va">OC</span><span class="op">)</span>, by <span class="op">=</span> <span class="st">"Sample_ID"</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">rename</span><span class="op">(</span>Organic_Carbon <span class="op">=</span> <span class="va">OC</span><span class="op">)</span></span></code></pre></div>
<p>Finally, our data is fully processed and ready to build linear
regression models using the <code>cpred</code> function. Let’s take a
look at the first 6 rows of the data:</p>
<p><strong>Table 1.</strong> <em>The first 6 rows of the</em>
<code>ref_dry_avg</code> <em>data set.</em></p>
<table class="table">
<thead><tr class="header">
<th align="left">Sample_ID</th>
<th align="right">Reflectance</th>
<th align="right">Organic_Carbon</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">A1AD.001</td>
<td align="right">0.8868612</td>
<td align="right">45.40</td>
</tr>
<tr class="even">
<td align="left">A1AD.002</td>
<td align="right">0.8635153</td>
<td align="right">45.70</td>
</tr>
<tr class="odd">
<td align="left">A1AD.003</td>
<td align="right">0.8830594</td>
<td align="right">38.50</td>
</tr>
<tr class="even">
<td align="left">A1AD.004</td>
<td align="right">0.9512481</td>
<td align="right">9.83</td>
</tr>
<tr class="odd">
<td align="left">A1AD.005</td>
<td align="right">0.9566361</td>
<td align="right">10.00</td>
</tr>
<tr class="even">
<td align="left">A1AD.006</td>
<td align="right">0.9565598</td>
<td align="right">9.62</td>
</tr>
</tbody>
</table>
<p>See the <code>process-ref_dry.Rmd</code> file for complete details on
how the raw data was processed for use in the <code>carbcontpred</code>
package.</p>
</div>
<div class="section level3">
<h3 id="cpred-function-overview">cpred Function Overview:<a class="anchor" aria-label="anchor" href="#cpred-function-overview"></a>
</h3>
<p>The <code>cpred</code> function builds a linear regression model
using spectral reflectance as the independent variable and organic
carbon content as the dependent variable and uses it to predict the
organic carbon content of soil samples based on their reflectance. The
function will utilize a dataset containing the spectral reflectance and
organic carbon content of soil samples. In this package, that dataset
will be <code>ref_dry_avg.rda</code>.</p>
<p>The cpred function can be applied using the following chunk:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span><span class="va">ref_dry_avg</span><span class="op">)</span></span>
<span><span class="va">pred_c</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/cpred.html">cpred</a></span><span class="op">(</span><span class="va">data</span>, <span class="st">"Reflectance"</span>, <span class="st">"Organic_Carbon"</span>, <span class="fl">0.7</span>, <span class="fl">10</span>, <span class="st">"Predicted_Organic_Carbon"</span><span class="op">)</span></span></code></pre></div>
<p>For the chunk above, the parameter <code>data</code> represents the
<code>ref_dry_avg</code> dataset. The parameter
<code>"Reflectance"</code> represents the <code>"Reflectance"</code>
column of the <code>ref_dry_avg</code> dataset which is the average
reflectance between 300 nm and 2500 nm of the post-dried soil samples.
The parameter <code>"Organic_Carbon"</code> represents the
<code>"Organic_Carbon"</code> column of the <code>ref_dry_avg</code>
dataset which is the measured organic carbon content by percent dry
weight of the post-dried soil samples. The parameters <code>0.7</code>
and <code>10</code> represent the test size for the model and the number
of folds for the cross-validation respectively. The parameter
<code>"Predicted_Organic_Carbon"</code> represents the name for the
predicted organic carbon content output.</p>
<p>The return of the function is a new column added to the previous
dataset which contains the predicted organic carbon content values using
a cross-validated linear regression model.</p>
<p>Let’s take a look at the 6 rows of this newly updated dataset
<code>pred_c</code> with the predicted organic carbon content
values:</p>
<p><strong>Table 2.</strong> <em>The first 6 rows of the</em>
<code>pred_c</code> <em>data set.</em></p>
<table class="table">
<thead><tr class="header">
<th align="left"></th>
<th align="left">Sample_ID</th>
<th align="right">Reflectance</th>
<th align="right">Organic_Carbon</th>
<th align="right">Predicted_Organic_Carbon</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">1</td>
<td align="left">A1AD.001</td>
<td align="right">0.8868612</td>
<td align="right">45.400</td>
<td align="right">44.248066</td>
</tr>
<tr class="even">
<td align="left">2</td>
<td align="left">A1AD.002</td>
<td align="right">0.8635153</td>
<td align="right">45.700</td>
<td align="right">53.439298</td>
</tr>
<tr class="odd">
<td align="left">3</td>
<td align="left">A1AD.003</td>
<td align="right">0.8830594</td>
<td align="right">38.500</td>
<td align="right">45.744814</td>
</tr>
<tr class="even">
<td align="left">6</td>
<td align="left">A1AD.006</td>
<td align="right">0.9565598</td>
<td align="right">9.620</td>
<td align="right">16.807794</td>
</tr>
<tr class="odd">
<td align="left">8</td>
<td align="left">A1AD.008</td>
<td align="right">0.9895953</td>
<td align="right">0.440</td>
<td align="right">3.801782</td>
</tr>
<tr class="even">
<td align="left">9</td>
<td align="left">A1AD.009</td>
<td align="right">0.9891859</td>
<td align="right">0.465</td>
<td align="right">3.962973</td>
</tr>
</tbody>
</table>
<p>Let’s visualize this data as a scatter plot where the original and
predicted organic carbon content values will be our X and Y axis
respectively:</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html" class="external-link">install.packages</a></span><span class="op">(</span><span class="st">"ggplot2"</span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">pred_c</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">Organic_Carbon</span>, y <span class="op">=</span> <span class="va">Predicted_Organic_Carbon</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_smooth.html" class="external-link">geom_smooth</a></span><span class="op">(</span>method <span class="op">=</span> <span class="st">"lm"</span>, color <span class="op">=</span> <span class="st">"red"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">"Organic_Carbon"</span>, y <span class="op">=</span> <span class="st">"Predicted_Organic_Carbon"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_minimal</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>panel.grid <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html" class="external-link">geom_hline</a></span><span class="op">(</span>yintercept <span class="op">=</span> <span class="fl">0</span>, linetype <span class="op">=</span> <span class="st">"solid"</span>, color <span class="op">=</span> <span class="st">"black"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html" class="external-link">geom_vline</a></span><span class="op">(</span>xintercept <span class="op">=</span> <span class="fl">0</span>, linetype <span class="op">=</span> <span class="st">"solid"</span>, color <span class="op">=</span> <span class="st">"black"</span><span class="op">)</span></span></code></pre></div>
<p><img src="scatterplot_pred_c.png" style="width:75.0%"></p>
<p><strong>Figure 2.</strong> <em>A scatterplot of the</em>
<code>pred_c</code> <em>data set where the measured and predicted
organic carbon content by percent dry weight of the samples are the X
and Y axis respectively.</em></p>
<p>Finally let’s evaluate our output by calculating the R<sup>2</sup>
value between the the original and predicted organic carbon content
values:</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">r_squared</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/cor.html" class="external-link">cor</a></span><span class="op">(</span><span class="va">pred_c</span><span class="op">$</span><span class="va">Organic_Carbon</span>, <span class="va">pred_c</span><span class="op">$</span><span class="va">Predicted_Organic_Carbon</span><span class="op">)</span><span class="op">^</span><span class="fl">2</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"R-squared:"</span>, <span class="va">r_squared</span>, <span class="st">"\n"</span><span class="op">)</span></span></code></pre></div>
<p>The R<sup>2</sup> value for this example is ~0.61, which is in line
with the R<sup>2</sup> values from studies that used standard global
soil spectral data from peatlands to predict organic carbon (de Sousa
Mendes et al., 2022).</p>
<p>See the <code>README.Rmd</code> files for additional details on how
to utilize <code>cpred</code>. See the <code>cpred.R</code> file for
additional information about the function.</p>
</div>
<div class="section level3">
<h3 id="pre-processing-data-for-mappred">Pre-Processing Data for mappred<a class="anchor" aria-label="anchor" href="#pre-processing-data-for-mappred"></a>
</h3>
<p>The <code>mappred</code> function uses two data sets. The first data
set is a file containing spatial information and spectral reflectance
values of an ROI. The example file used in the vignette is
<code>Reflectance_ROI.csv</code> in the
<code>\inst\extdata folder</code>. For more information on how to
extract an ROI data file, see (INSERT WEBSITE LINK). The second data set
consists of the sample ID, average reflectance, and measured and
predicted organic carbon content of post-dried soil samples. This is
normally the output from the <code>cpred</code> function as shown in the
previous section. The example file used in the vignette is
<code>pred_c.rda</code> in the <code>\data folder</code>.</p>
</div>
<div class="section level3">
<h3 id="mappred-function-overview">mappred Function Overview:<a class="anchor" aria-label="anchor" href="#mappred-function-overview"></a>
</h3>
<p>The <code>mappred</code> function extracts an algebraic equation
based on the reflectance and predicted organic carbon content of soil
samples in a data set. The function then applies min-max normalization
over the reflectance values of an ROI data set. Finally, the
<code>mappred</code> function uses the algebraic equation to predict the
organic carbon content of spatial points in the ROI data set based on
their reflectance, and then outputs the updated data set as a new csv
file. The function will utilize two data sets, one containing the
spatial information and spectral reflectance values of an ROI and one
containing the reflectance and predicted organic carbon content of soil
samples. In this package, the ROI data set will be
<code>Reflectance_ROI.csv</code> and the predicted organic carbon
content dataset will be <code>pred_c.rda</code>.</p>
<p>The mappred function can be applied using the following chunk:</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mappred_c</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/mappred.html">mappred</a></span><span class="op">(</span><span class="va">pred_c</span>, <span class="st">"Reflectance"</span>, <span class="st">"Predicted_Organic_Carbon"</span>, <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"extdata"</span>, <span class="st">"Reflectance_ROI.csv"</span>, package <span class="op">=</span> <span class="st">"carbcontpred"</span><span class="op">)</span>, <span class="st">"ROI_Predicted_Carbon"</span><span class="op">)</span></span></code></pre></div>
<p>For the chunk above, the parameter <code>pred_c</code> represents the
<code>pred_c</code> dataset. The parameter <code>"Reflectance"</code>
represents the <code>"Reflectance"</code> column of the
<code>pred_c</code> dataset which is the average reflectance between 300
nm and 2500 nm of the post-dried soil samples. The parameter
<code>"Predicted_Organic_Carbon"</code> represents the
<code>"Predicted_Organic_Carbon"</code> column of the
<code>pred_c</code> dataset which is the predicted organic carbon
content by percent dry weight of the post-dried soil samples. The
parameter
<code>system.file("extdata", "Reflectance_ROI.csv", package = "carbcontpred")</code>
represents the path to the <code>Reflectance_ROI.csv</code> file. The
parameter <code>"ROI_Predicted_Carbon"</code> represents the name for
output of the updated data set which will contain the predicted organic
carbon content of spatial points in the <code>Reflectance_ROI.csv</code>
file.</p>
<p>The return of the function is a csv file which contains the spatial
information of the ROI data set but replaces the reflectance values for
the points with the predicted organic carbon content. The original
reflectance values and the replacement predicted organic carbon content
are typically in the <code>B1</code> of the ROI data set. It is not
recommended to run the <code>mappred</code> function again using this
new ROI data set in place of the original ROI data set containing the
reflectance values.</p>
<p>Let’s take a look at 6 rows of this newly created data file
<code>ROI_Predicted_Carbon.csv</code> with the predicted organic carbon
content values:</p>
<p><strong>Table 3.</strong> <em>The first 6 rows of the</em>
<code>ROI_Predicted_Carbon.csv</code> <em>data file.</em></p>
<table class="table">
<thead><tr class="header">
<th align="right">X..File.X</th>
<th align="right">File.Y</th>
<th align="right">Map.X</th>
<th align="right">Map.Y</th>
<th align="right">Lat</th>
<th align="right">Lon</th>
<th align="right">B1</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="right">91</td>
<td align="right">1677</td>
<td align="right">-5517591</td>
<td align="right">5894728</td>
<td align="right">53.01250</td>
<td align="right">-82.47585</td>
<td align="right">68.85428</td>
</tr>
<tr class="even">
<td align="right">92</td>
<td align="right">1677</td>
<td align="right">-5517128</td>
<td align="right">5894728</td>
<td align="right">53.01250</td>
<td align="right">-82.46892</td>
<td align="right">72.12532</td>
</tr>
<tr class="odd">
<td align="right">90</td>
<td align="right">1677</td>
<td align="right">-5518054</td>
<td align="right">5894728</td>
<td align="right">53.01250</td>
<td align="right">-82.48277</td>
<td align="right">68.85428</td>
</tr>
<tr class="even">
<td align="right">89</td>
<td align="right">1678</td>
<td align="right">-5518518</td>
<td align="right">5894264</td>
<td align="right">53.00833</td>
<td align="right">-82.48174</td>
<td align="right">72.87362</td>
</tr>
<tr class="odd">
<td align="right">90</td>
<td align="right">1678</td>
<td align="right">-5518054</td>
<td align="right">5894264</td>
<td align="right">53.00833</td>
<td align="right">-82.47481</td>
<td align="right">72.87362</td>
</tr>
<tr class="even">
<td align="right">91</td>
<td align="right">1678</td>
<td align="right">-5517591</td>
<td align="right">5894264</td>
<td align="right">53.00833</td>
<td align="right">-82.46789</td>
<td align="right">72.12532</td>
</tr>
</tbody>
</table>
<p>Let’s visualize this data as a histogram where the value and count of
the <code>B1</code> column in the <code>ROI_Predicted_Carbon.csv</code>
data set will be our X and Y axis respectively:</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html" class="external-link">install.packages</a></span><span class="op">(</span><span class="st">"ggplot2"</span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">ROI_Predicted_Carbon</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">B1</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">"Value of B1"</span>, y <span class="op">=</span> <span class="st">"Count of B1"</span><span class="op">)</span> <span class="op">+</span> </span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_histogram.html" class="external-link">geom_histogram</a></span><span class="op">(</span>binwidth<span class="op">=</span> <span class="fl">.5</span>, colour<span class="op">=</span> <span class="st">"black"</span>, fill<span class="op">=</span> <span class="st">"white"</span><span class="op">)</span> <span class="op">+</span> </span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_minimal</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>panel.grid <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html" class="external-link">geom_hline</a></span><span class="op">(</span>yintercept <span class="op">=</span> <span class="fl">0</span>, linetype <span class="op">=</span> <span class="st">"solid"</span>, color <span class="op">=</span> <span class="st">"black"</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html" class="external-link">geom_vline</a></span><span class="op">(</span>xintercept <span class="op">=</span> <span class="fl">0</span>, linetype <span class="op">=</span> <span class="st">"solid"</span>, color <span class="op">=</span> <span class="st">"black"</span><span class="op">)</span></span></code></pre></div>
<p><img src="count_histogram_ROI_Predicted_Carbon.png" style="width:75.0%"></p>
<p><strong>Figure 3.</strong> <em>A histogram of the</em>
<code>ROI_Predicted_Carbon.csv</code> <em>data file where the spectral
reflectance value and the count of points with that value are the X and
Y axis respectively.</em></p>
<p>We can also visualize the <code>ROI_Predicted_Carbon.csv</code> data
set as a histogram with a kernel density curve where the value and
density of the <code>B1</code> column in the
<code>ROI_Predicted_Carbon.csv</code> data set will be our X and Y axis
respectively:</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">ROI_Predicted_Carbon</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">B1</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_histogram.html" class="external-link">geom_histogram</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>y <span class="op">=</span> <span class="va">..density..</span><span class="op">)</span>,</span>
<span>                   binwidth <span class="op">=</span> <span class="fl">.5</span>,</span>
<span>                   colour <span class="op">=</span> <span class="st">"black"</span>, fill <span class="op">=</span> <span class="st">"white"</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">"Value of B1"</span>, y <span class="op">=</span> <span class="st">"Density of B1"</span><span class="op">)</span> <span class="op">+</span> </span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_minimal</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>panel.grid <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html" class="external-link">geom_hline</a></span><span class="op">(</span>yintercept <span class="op">=</span> <span class="fl">0</span>, linetype <span class="op">=</span> <span class="st">"solid"</span>, color <span class="op">=</span> <span class="st">"black"</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html" class="external-link">geom_vline</a></span><span class="op">(</span>xintercept <span class="op">=</span> <span class="fl">0</span>, linetype <span class="op">=</span> <span class="st">"solid"</span>, color <span class="op">=</span> <span class="st">"black"</span><span class="op">)</span> <span class="op">+</span> </span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_density.html" class="external-link">geom_density</a></span><span class="op">(</span>alpha <span class="op">=</span> <span class="fl">.2</span>, fill <span class="op">=</span> <span class="st">"#FF6666"</span><span class="op">)</span></span></code></pre></div>
<p><img src="density_histogram_ROI_Predicted_Carbon.png" style="width:75.0%"></p>
<p><strong>Figure 4.</strong> <em>A histogram of the</em>
<code>ROI_Predicted_Carbon.csv</code> <em>data file where the spectral
reflectance value and the density of points with that value are the X
and Y axis respectively. A kernel density curve is overlaid on the
histogram in red.</em></p>
<p>To see how to use <code>ROI_Predicted_Carbon.csv</code> or another
output from <code>mappred</code> to visualize the predicted organic
carbon content of the ROI over a map, see (INSERT WEBSITE LINK).</p>
<p>See the <code>README.Rmd</code> files for additional details on how
to utilize <code>mappred</code>. See the <code>mappred.R</code> file for
additional information about the function.</p>
</div>
</div>
<div class="section level2">
<h2 id="contributing-to-the-carbcontpred-package">Contributing to the carbcontpred Package<a class="anchor" aria-label="anchor" href="#contributing-to-the-carbcontpred-package"></a>
</h2>
<p>The purpose of this <code>R</code> package is to make the soil
spectral reflectance and organic carbon content data from a 2022
McMaster University Remote Sensing Laboratory project easily available
for predictive modeling and mapping in an <code>R</code> environment.
Currently, the package only uses the reflectance and organic carbon
content data of the post-dried soil samples, but we invite others from
the community to request additional metrics from the original project
dataset, report issues such as spelling errors, and contribute to the
<code>carbcontpred</code> package. To contribute to the package, create
a branch in the repository and submit a pull request for your
contribution. Contributions will be reviewed before approval and full
credit will be given.</p>
</div>
<div class="section level2">
<h2 id="references">References<a class="anchor" aria-label="anchor" href="#references"></a>
</h2>
<p>de Sousa Mendes, W., Sommer, M., Koszinski, S., &amp; Wehrhan, M.
(2022). Peatlands spectral data influence in   global spectral modelling
of soil organic carbon and total nitrogen using visible-near-infrared
spectroscopy.   <em>Journal of Environmental Management</em>,
<em>317</em>, 115383. <a href="https://doi.org/10.1016/j.jenvman.2022.115383" class="external-link uri">https://doi.org/10.1016/j.jenvman.2022.115383</a></p>
</div>

  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by Kangyu So.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
